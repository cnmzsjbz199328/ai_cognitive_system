<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½è¿æ¥çº¿æ¼”ç¤º</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .demo-container {
            position: relative;
            width: 100%;
            max-width: 1200px;
            height: 700px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .demo-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 15;
            pointer-events: none;
        }
        
        .demo-module {
            position: absolute;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
            border: 2px solid #3498db;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: move;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            min-width: 120px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            font-size: 12px;
            font-weight: bold;
        }
        
        .demo-module:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 48px rgba(52, 152, 219, 0.2);
            border-color: #e74c3c;
            z-index: 20;
        }
        
        .connection-line {
            stroke: #3498db;
            stroke-width: 3;
            opacity: 0.7;
            transition: all 0.3s ease;
            filter: drop-shadow(0 0 4px rgba(52, 152, 219, 0.3));
        }
        
        .connection-line:hover {
            stroke-width: 5;
            opacity: 1;
        }
        
        .anchor-point {
            transition: all 0.3s ease;
        }
        
        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            z-index: 100;
        }
        
        .controls h2 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 18px;
        }
        
        .control-group {
            margin: 10px 0;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #34495e;
        }
        
        button {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }
        
        .btn-mode {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }
        
        .btn-mode:hover {
            background: linear-gradient(135deg, #8e44ad, #663399);
            transform: translateY(-2px);
        }
        
        .btn-debug {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }
        
        .btn-debug:hover {
            background: linear-gradient(135deg, #e67e22, #d35400);
            transform: translateY(-2px);
        }
        
        .btn-redraw {
            background: linear-gradient(135deg, #3498db, #2980b9);
        }
        
        .btn-redraw:hover {
            background: linear-gradient(135deg, #2980b9, #1abc9c);
            transform: translateY(-2px);
        }
        
        .info-panel {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            max-width: 300px;
            z-index: 100;
        }
        
        .info-panel h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 16px;
        }
        
        .info-panel p {
            margin: 5px 0;
            color: #34495e;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1 style="text-align: center; color: white; margin-bottom: 30px;">ğŸ”— æ™ºèƒ½è¿æ¥çº¿ç³»ç»Ÿæ¼”ç¤º</h1>
    
    <div class="demo-container">
        <svg class="demo-svg" id="demo-svg" xmlns="http://www.w3.org/2000/svg">
            <!-- è¿æ¥çº¿å°†åœ¨è¿™é‡Œç»˜åˆ¶ -->
        </svg>
        
        <!-- ç¬¬ä¸€å±‚ï¼šå…¨å±€æ—¶é—´ç³»ç»Ÿ -->
        <div class="module" id="global-time" style="top: 80px; left: 50%; transform: translateX(-50%);">
            <div class="module-name">Global Time System<br>å…¨å±€æ—¶é—´ç³»ç»Ÿ</div>
        </div>

        <!-- ç¬¬äºŒå±‚ï¼šè¾“å…¥æµç¨‹ -->
        <div class="module" id="external-stimuli" style="top: 180px; left: 100px;">
            <div class="module-name">External Stimuli<br>å¤–éƒ¨åˆºæ¿€</div>
        </div>

        <div class="module" id="perception" style="top: 180px; left: 350px;">
            <div class="module-name">Perception & Input<br>æ„ŸçŸ¥ä¸è¾“å…¥æ¨¡å—</div>
        </div>

        <div class="module" id="ai-cognitive" style="top: 180px; left: 600px;">
            <div class="module-name">AI Cognitive Core<br>AIè®¤çŸ¥æ ¸å¿ƒ</div>
        </div>

        <!-- ç¬¬ä¸‰å±‚ï¼šæ€ç»´æ ¸å¿ƒ -->
        <div class="module" id="thinking-core" style="top: 280px; left: 50%; transform: translateX(-50%);">
            <div class="module-name">Thinking Core<br>æ€ç»´æ ¸å¿ƒ</div>
        </div>

        <!-- ç¬¬å››å±‚ï¼šå¤„ç†æ¨¡å—ç¾¤ï¼ˆæ°´å¹³æ’åˆ—ï¼‰ -->
        <div class="module" id="personality" style="top: 380px; left: 80px;">
            <div class="module-name">Personality & Emotion<br>ä¸ªæ€§ä¸æƒ…æ„Ÿæ ¸å¿ƒ</div>
        </div>

        <div class="module" id="skills" style="top: 380px; left: 280px;">
            <div class="module-name">Skills Module<br>æŠ€èƒ½æ¨¡å—</div>
        </div>

        <div class="module" id="needs" style="top: 380px; left: 480px;">
            <div class="module-name">Needs & Motivation<br>éœ€æ±‚ä¸åŠ¨æœºç³»ç»Ÿ</div>
        </div>

        <div class="module" id="planning" style="top: 380px; left: 680px;">
            <div class="module-name">Planning System<br>è§„åˆ’ç³»ç»Ÿ</div>
        </div>

        <div class="module" id="relationship" style="top: 380px; left: 880px;">
            <div class="module-name">Relationship Module<br>å…³ç³»æ¨¡å—</div>
        </div>

        <!-- ç¬¬äº”å±‚ï¼šè¾“å‡ºæµç¨‹ -->
        <div class="module" id="action-output" style="top: 480px; left: 50%; transform: translateX(-50%);">
            <div class="module-name">Action & Output<br>è¡ŒåŠ¨ä¸è¾“å‡ºæ¨¡å—</div>
        </div>

        <!-- ç¬¬å…­å±‚ï¼šç¯å¢ƒäº¤äº’å’Œè®°å¿† -->
        <div class="module" id="environment" style="top: 580px; left: 300px;">
            <div class="module-name">Environment Interaction<br>ç¯å¢ƒäº¤äº’æ¨¡å—</div>
        </div>

        <div class="module" id="memory" style="top: 580px; left: 650px;">
            <div class="module-name">Memory System<br>è®°å¿†ç³»ç»Ÿ</div>
        </div>
        
        <div class="controls">
            <h2>ğŸ›ï¸ æ§åˆ¶é¢æ¿</h2>
            
            <div class="control-group">
                <label>è¿æ¥æ¨¡å¼ï¼š</label>
                <button class="btn-mode" id="mode-btn" onclick="toggleMode()">åˆ‡æ¢åˆ°ç›´è§’</button>
            </div>
            
            <div class="control-group">
                <label>è°ƒè¯•åŠŸèƒ½ï¼š</label>
                <button class="btn-debug" id="anchor-btn" onclick="toggleAnchors()">æ˜¾ç¤ºé”šç‚¹</button>
            </div>
            
            <div class="control-group">
                <label>æ“ä½œï¼š</label>
                <button class="btn-redraw" onclick="redrawConnections()">é‡æ–°ç»˜åˆ¶</button>
            </div>
        </div>
        
        <div class="info-panel">
            <h3>ğŸ’¡ åŠŸèƒ½è¯´æ˜</h3>
            <p><strong>æ™ºèƒ½é”šç‚¹ï¼š</strong> è‡ªåŠ¨é€‰æ‹©æ¨¡å—çš„æœ€ä½³è¿æ¥ç‚¹</p>
            <p><strong>æ›²çº¿æ¨¡å¼ï¼š</strong> å¹³æ»‘çš„è´å¡å°”æ›²çº¿è¿æ¥</p>
            <p><strong>ç›´è§’æ¨¡å¼ï¼š</strong> ä¸“ä¸šçš„æ­£äº¤è¿æ¥çº¿</p>
            <p><strong>æ‹–æ‹½æ”¯æŒï¼š</strong> æ‹–åŠ¨æ¨¡å—ï¼Œè¿æ¥çº¿è‡ªåŠ¨æ›´æ–°</p>
            <p>å½“å‰æ¨¡å¼ï¼š<span id="current-mode">æ›²çº¿</span></p>
        </div>
    </div>

    <script>
        let connectionMode = 'curved'; // 'curved' æˆ– 'orthogonal'
        let showAnchorPoints = false;
        let isDragging = false;
        let dragTarget = null;
        let dragOffset = { x: 0, y: 0 };
        
        // è¿æ¥å…³ç³»å®šä¹‰
        const demoConnections = [
            ['module-a', 'module-f'],
            ['module-b', 'module-f'],
            ['module-f', 'module-c'],
            ['module-c', 'module-d'],
            ['module-c', 'module-e'],
            ['module-d', 'module-e'],
            ['module-a', 'module-b']
        ];
        
        // è·å–æ¨¡å—çš„4ä¸ªé”šç‚¹
        function getModuleAnchorPoints(moduleId) {
            const module = document.getElementById(moduleId);
            if (!module) return null;
            
            const rect = module.getBoundingClientRect();
            const containerRect = document.querySelector('.demo-container').getBoundingClientRect();
            
            const moduleRect = {
                left: rect.left - containerRect.left,
                top: rect.top - containerRect.top,
                width: rect.width,
                height: rect.height
            };
            
            return {
                top: {
                    x: moduleRect.left + moduleRect.width / 2,
                    y: moduleRect.top,
                    direction: 'top'
                },
                right: {
                    x: moduleRect.left + moduleRect.width,
                    y: moduleRect.top + moduleRect.height / 2,
                    direction: 'right'
                },
                bottom: {
                    x: moduleRect.left + moduleRect.width / 2,
                    y: moduleRect.top + moduleRect.height,
                    direction: 'bottom'
                },
                left: {
                    x: moduleRect.left,
                    y: moduleRect.top + moduleRect.height / 2,
                    direction: 'left'
                }
            };
        }
        
        // é€‰æ‹©æœ€ä½³é”šç‚¹å¯¹
        function selectBestAnchorPair(fromAnchors, toAnchors) {
            let bestDistance = Infinity;
            let bestPair = null;
            
            ['top', 'right', 'bottom', 'left'].forEach(fromDir => {
                ['top', 'right', 'bottom', 'left'].forEach(toDir => {
                    const fromAnchor = fromAnchors[fromDir];
                    const toAnchor = toAnchors[toDir];
                    
                    // é¿å…å†²çªè¿æ¥
                    if (areAnchorsConflicting(fromDir, toDir)) return;
                    
                    const distance = Math.sqrt(
                        Math.pow(fromAnchor.x - toAnchor.x, 2) + 
                        Math.pow(fromAnchor.y - toAnchor.y, 2)
                    );
                    
                    if (distance < bestDistance) {
                        bestDistance = distance;
                        bestPair = { from: fromAnchor, to: toAnchor };
                    }
                });
            });
            
            return bestPair;
        }
        
        function areAnchorsConflicting(fromDir, toDir) {
            const conflicts = [
                ['right', 'left'], ['left', 'right'], 
                ['top', 'bottom'], ['bottom', 'top']
            ];
            
            return conflicts.some(([dir1, dir2]) => 
                (fromDir === dir1 && toDir === dir2) || 
                (fromDir === dir2 && toDir === dir1)
            );
        }
        
        // åˆ›å»ºæ›²çº¿è·¯å¾„
        function createCurvedPath(fromAnchor, toAnchor) {
            const dx = toAnchor.x - fromAnchor.x;
            const dy = toAnchor.y - fromAnchor.y;
            const controlOffset = Math.max(Math.abs(dx), Math.abs(dy)) * 0.4;
            
            let cp1x = fromAnchor.x, cp1y = fromAnchor.y;
            let cp2x = toAnchor.x, cp2y = toAnchor.y;
            
            // æ ¹æ®æ–¹å‘è°ƒæ•´æ§åˆ¶ç‚¹
            switch (fromAnchor.direction) {
                case 'top': cp1y -= controlOffset; break;
                case 'bottom': cp1y += controlOffset; break;
                case 'left': cp1x -= controlOffset; break;
                case 'right': cp1x += controlOffset; break;
            }
            
            switch (toAnchor.direction) {
                case 'top': cp2y -= controlOffset; break;
                case 'bottom': cp2y += controlOffset; break;
                case 'left': cp2x -= controlOffset; break;
                case 'right': cp2x += controlOffset; break;
            }
            
            return `M ${fromAnchor.x} ${fromAnchor.y} C ${cp1x} ${cp1y}, ${cp2x} ${cp2y}, ${toAnchor.x} ${toAnchor.y}`;
        }
        
        // åˆ›å»ºç›´è§’è·¯å¾„
        function createOrthogonalPath(fromAnchor, toAnchor) {
            let path = `M ${fromAnchor.x} ${fromAnchor.y}`;
            
            if (fromAnchor.direction === 'right' && toAnchor.direction === 'left') {
                const midX = (fromAnchor.x + toAnchor.x) / 2;
                path += ` L ${midX} ${fromAnchor.y} L ${midX} ${toAnchor.y}`;
            } else if (fromAnchor.direction === 'bottom' && toAnchor.direction === 'top') {
                const midY = (fromAnchor.y + toAnchor.y) / 2;
                path += ` L ${fromAnchor.x} ${midY} L ${toAnchor.x} ${midY}`;
            } else {
                // Lå½¢è¿æ¥
                if (fromAnchor.direction === 'right' || fromAnchor.direction === 'left') {
                    path += ` L ${toAnchor.x} ${fromAnchor.y}`;
                } else {
                    path += ` L ${fromAnchor.x} ${toAnchor.y}`;
                }
            }
            
            path += ` L ${toAnchor.x} ${toAnchor.y}`;
            return path;
        }
        
        // ç»˜åˆ¶è¿æ¥çº¿
        function drawConnections() {
            const svg = document.getElementById('demo-svg');
            svg.innerHTML = '';
            
            demoConnections.forEach(([from, to]) => {
                const fromAnchors = getModuleAnchorPoints(from);
                const toAnchors = getModuleAnchorPoints(to);
                
                if (!fromAnchors || !toAnchors) return;
                
                const anchorPair = selectBestAnchorPair(fromAnchors, toAnchors);
                if (!anchorPair) return;
                
                let pathData;
                if (connectionMode === 'curved') {
                    pathData = createCurvedPath(anchorPair.from, anchorPair.to);
                } else {
                    pathData = createOrthogonalPath(anchorPair.from, anchorPair.to);
                }
                
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathData);
                path.setAttribute('stroke', '#3498db');
                path.setAttribute('stroke-width', '3');
                path.setAttribute('fill', 'none');
                path.setAttribute('opacity', '0.7');
                path.className = 'connection-line';
                
                if (connectionMode === 'curved') {
                    path.setAttribute('stroke-linecap', 'round');
                } else {
                    path.setAttribute('stroke-linejoin', 'round');
                }
                
                svg.appendChild(path);
                
                // æ·»åŠ é”šç‚¹å¯è§†åŒ–
                if (showAnchorPoints) {
                    addAnchorVisualization(svg, anchorPair.from, '#e74c3c');
                    addAnchorVisualization(svg, anchorPair.to, '#27ae60');
                }
            });
        }
        
        function addAnchorVisualization(svg, anchor, color) {
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('cx', anchor.x);
            circle.setAttribute('cy', anchor.y);
            circle.setAttribute('r', '5');
            circle.setAttribute('fill', color);
            circle.setAttribute('opacity', '0.8');
            circle.className = 'anchor-point';
            svg.appendChild(circle);
        }
        
        // æ§åˆ¶å‡½æ•°
        function toggleMode() {
            connectionMode = connectionMode === 'curved' ? 'orthogonal' : 'curved';
            document.getElementById('mode-btn').textContent = 
                connectionMode === 'curved' ? 'åˆ‡æ¢åˆ°ç›´è§’' : 'åˆ‡æ¢åˆ°æ›²çº¿';
            document.getElementById('current-mode').textContent = 
                connectionMode === 'curved' ? 'æ›²çº¿' : 'ç›´è§’';
            drawConnections();
        }
        
        function toggleAnchors() {
            showAnchorPoints = !showAnchorPoints;
            document.getElementById('anchor-btn').textContent = 
                showAnchorPoints ? 'éšè—é”šç‚¹' : 'æ˜¾ç¤ºé”šç‚¹';
            drawConnections();
        }
        
        function redrawConnections() {
            drawConnections();
        }
        
        // æ‹–æ‹½åŠŸèƒ½
        function setupDragAndDrop() {
            document.querySelectorAll('.demo-module').forEach(module => {
                module.addEventListener('mousedown', startDrag);
            });
            
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);
        }
        
        function startDrag(e) {
            isDragging = true;
            dragTarget = e.target.closest('.demo-module');
            
            const rect = dragTarget.getBoundingClientRect();
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;
            
            e.preventDefault();
        }
        
        function drag(e) {
            if (!isDragging || !dragTarget) return;
            
            const container = document.querySelector('.demo-container');
            const containerRect = container.getBoundingClientRect();
            
            const x = e.clientX - containerRect.left - dragOffset.x;
            const y = e.clientY - containerRect.top - dragOffset.y;
            
            const maxX = container.clientWidth - dragTarget.offsetWidth;
            const maxY = container.clientHeight - dragTarget.offsetHeight;
            
            dragTarget.style.left = Math.max(0, Math.min(x, maxX)) + 'px';
            dragTarget.style.top = Math.max(0, Math.min(y, maxY)) + 'px';
            dragTarget.style.right = 'auto';
            dragTarget.style.bottom = 'auto';
            dragTarget.style.transform = 'none';
            
            drawConnections();
        }
        
        function endDrag() {
            isDragging = false;
            dragTarget = null;
        }
        
        // åˆå§‹åŒ–
        window.addEventListener('load', function() {
            setupDragAndDrop();
            setTimeout(drawConnections, 100);
        });
    </script>
</body>
</html> 