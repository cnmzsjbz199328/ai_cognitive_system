<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹–æ‹½ç³»ç»Ÿæµ‹è¯• - AIè®¤çŸ¥ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .debug-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 12px;
            line-height: 1.4;
            z-index: 1000;
            min-width: 250px;
        }
        
        .debug-title {
            color: #00ff88;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .debug-item {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
        }
        
        .debug-label {
            color: #66ccff;
        }
        
        .debug-value {
            color: #ffcc66;
        }
        
        .test-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }
        
        .test-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .test-btn:hover {
            background: linear-gradient(135deg, #2980b9, #1abc9c);
            transform: translateY(-2px);
        }
        
        .coordinate-display {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 11px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="system-title">
            <h1>æ‹–æ‹½ç³»ç»Ÿæµ‹è¯• - AIè®¤çŸ¥ç³»ç»Ÿ</h1>
        </div>

        <svg class="connections-svg" id="connections-svg">
            <!-- è¿æ¥çº¿å°†åœ¨è¿™é‡ŒåŠ¨æ€ç»˜åˆ¶ -->
        </svg>

        <!-- æµ‹è¯•æ¨¡å— -->
        <div class="module" id="global-time" style="top: 580px; left: 150px;">
            <div class="module-name">Global Time System<br>Temporal Coordination</div>
        </div>

        <div class="module" id="external-stimuli" style="top: 180px; left: 150px;">
            <div class="module-name">External Stimuli<br>Information Input</div>
        </div>

        <div class="module" id="perception" style="top: 380px; left: 150px;">
            <div class="module-name">Perception & Input<br>Sensory Processing</div>
        </div>

        <div class="module" id="ai-cognitive" style="top: 180px; left: 480px;">
            <div class="module-name">AI Cognitive Core<br>Central Processing</div>
        </div>

        <div class="module" id="thinking-core" style="top: 280px; left: 50%; transform: translateX(-50%);">
            <div class="module-name">Thinking Core<br>Decision Making</div>
        </div>

        <div class="module" id="personality" style="top: 380px; left: 1180px;">
            <div class="module-name">Personality & Emotion<br>Character Traits</div>
        </div>

        <div class="module" id="memory" style="top: 380px; left: 480px;">
            <div class="module-name">Memory System<br>Information Storage</div>
        </div>

        <div class="control-panel">
            <button class="btn btn-secondary" onclick="resetModulePositions()">é‡ç½®ä½ç½®</button>
            <button class="btn btn-toggle" id="connections-toggle" onclick="toggleConnections()">éšè—è¿æ¥çº¿</button>
            <div class="speed-control">
                <span>ç¼©æ”¾:</span>
                <input type="range" class="speed-slider" min="50" max="150" value="100" id="zoom-slider">
            </div>
        </div>
    </div>

    <!-- è°ƒè¯•é¢æ¿ -->
    <div class="debug-panel" id="debug-panel">
        <div class="debug-title">ğŸ”§ æ‹–æ‹½è°ƒè¯•ä¿¡æ¯</div>
        <div class="debug-item">
            <span class="debug-label">æ‹–æ‹½çŠ¶æ€:</span>
            <span class="debug-value" id="drag-status">æœªæ‹–æ‹½</span>
        </div>
        <div class="debug-item">
            <span class="debug-label">å½“å‰æ¨¡å—:</span>
            <span class="debug-value" id="current-module">æ— </span>
        </div>
        <div class="debug-item">
            <span class="debug-label">é¼ æ ‡åæ ‡:</span>
            <span class="debug-value" id="mouse-coords">-</span>
        </div>
        <div class="debug-item">
            <span class="debug-label">å®¹å™¨åæ ‡:</span>
            <span class="debug-value" id="container-coords">-</span>
        </div>
        <div class="debug-item">
            <span class="debug-label">åç§»é‡:</span>
            <span class="debug-value" id="drag-offset">-</span>
        </div>
        <div class="debug-item">
            <span class="debug-label">å®¹å™¨ç¼©æ”¾:</span>
            <span class="debug-value" id="container-scale">1.0</span>
        </div>
        <div class="debug-item">
            <span class="debug-label">æ€§èƒ½:</span>
            <span class="debug-value" id="performance">60fps</span>
        </div>
    </div>

    <!-- æµ‹è¯•æŒ‰é’® -->
    <div class="test-buttons">
        <button class="test-btn" onclick="testZoom(0.8)">ç¼©æ”¾ 80%</button>
        <button class="test-btn" onclick="testZoom(1.0)">ç¼©æ”¾ 100%</button>
        <button class="test-btn" onclick="testZoom(1.2)">ç¼©æ”¾ 120%</button>
        <button class="test-btn" onclick="showDebugGrid()">æ˜¾ç¤ºç½‘æ ¼</button>
    </div>

    <!-- åæ ‡æ˜¾ç¤º -->
    <div class="coordinate-display" id="coordinate-display">
        <div>é¼ æ ‡: <span id="mouse-display">0, 0</span></div>
        <div>å®¹å™¨: <span id="container-display">0, 0</span></div>
    </div>

    <script type="module">
        import { initializeSystem } from './js/main.js';
        import { getDragState, resetModulePositions } from './js/dragdrop.js';
        import { toggleConnections } from './js/connections.js';

        // å…¨å±€å‡½æ•°
        window.resetModulePositions = resetModulePositions;
        window.toggleConnections = toggleConnections;

        // è°ƒè¯•å˜é‡
        let frameCount = 0;
        let lastTime = performance.now();

        // åˆå§‹åŒ–ç³»ç»Ÿ
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ§ª åˆå§‹åŒ–æ‹–æ‹½æµ‹è¯•ç³»ç»Ÿ...');
            initializeSystem();
            startDebugMonitoring();
        });

        // ç¼©æ”¾æµ‹è¯•
        window.testZoom = function(scale) {
            const container = document.querySelector('.container');
            container.style.transform = `scale(${scale})`;
            updateDebugInfo();
        };

        // æ˜¾ç¤ºè°ƒè¯•ç½‘æ ¼
        window.showDebugGrid = function() {
            const existingGrid = document.getElementById('debug-grid');
            if (existingGrid) {
                existingGrid.remove();
                return;
            }

            const grid = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            grid.id = 'debug-grid';
            grid.style.cssText = `
                position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                z-index: 0; pointer-events: none; opacity: 0.3;
            `;

            // åˆ›å»ºç½‘æ ¼çº¿
            for (let x = 0; x < 2000; x += 50) {
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', x);
                line.setAttribute('y1', 0);
                line.setAttribute('x2', x);
                line.setAttribute('y2', 1000);
                line.setAttribute('stroke', '#00ff88');
                line.setAttribute('stroke-width', '0.5');
                grid.appendChild(line);
            }

            for (let y = 0; y < 1000; y += 50) {
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', 0);
                line.setAttribute('y1', y);
                line.setAttribute('x2', 2000);
                line.setAttribute('y2', y);
                line.setAttribute('stroke', '#00ff88');
                line.setAttribute('stroke-width', '0.5');
                grid.appendChild(line);
            }

            document.querySelector('.container').appendChild(grid);
        };

        // å¯åŠ¨è°ƒè¯•ç›‘æ§
        function startDebugMonitoring() {
            function updateDebug() {
                updateDebugInfo();
                updatePerformance();
                requestAnimationFrame(updateDebug);
            }
            updateDebug();

            // é¼ æ ‡ç§»åŠ¨ç›‘æ§
            document.addEventListener('mousemove', (e) => {
                updateMouseCoords(e.clientX, e.clientY);
            });

            // ç¼©æ”¾æ»‘å—
            document.getElementById('zoom-slider').addEventListener('input', (e) => {
                const scale = parseInt(e.target.value) / 100;
                testZoom(scale);
            });
        }

        // æ›´æ–°è°ƒè¯•ä¿¡æ¯
        function updateDebugInfo() {
            const dragState = getDragState();
            
            document.getElementById('drag-status').textContent = 
                dragState.isDragging ? 'æ‹–æ‹½ä¸­' : 'æœªæ‹–æ‹½';
            
            document.getElementById('current-module').textContent = 
                dragState.dragTarget ? dragState.dragTarget.id : 'æ— ';
            
            document.getElementById('drag-offset').textContent = 
                `${Math.round(dragState.dragOffset.x)}, ${Math.round(dragState.dragOffset.y)}`;
            
            document.getElementById('container-scale').textContent = 
                `${dragState.containerScale.scaleX.toFixed(2)}`;
        }

        // æ›´æ–°é¼ æ ‡åæ ‡
        function updateMouseCoords(clientX, clientY) {
            document.getElementById('mouse-coords').textContent = `${clientX}, ${clientY}`;
            document.getElementById('mouse-display').textContent = `${clientX}, ${clientY}`;
            
            // è½¬æ¢ä¸ºå®¹å™¨åæ ‡
            const container = document.querySelector('.container');
            const rect = container.getBoundingClientRect();
            const transform = window.getComputedStyle(container).transform;
            
            let scale = 1;
            if (transform && transform !== 'none') {
                const matrix = transform.match(/matrix\(([^)]+)\)/);
                if (matrix) {
                    scale = parseFloat(matrix[1].split(',')[0]);
                }
            }
            
            const containerX = (clientX - rect.left) / scale;
            const containerY = (clientY - rect.top) / scale;
            
            document.getElementById('container-coords').textContent = 
                `${Math.round(containerX)}, ${Math.round(containerY)}`;
            document.getElementById('container-display').textContent = 
                `${Math.round(containerX)}, ${Math.round(containerY)}`;
        }

        // æ›´æ–°æ€§èƒ½ä¿¡æ¯
        function updatePerformance() {
            frameCount++;
            const currentTime = performance.now();
            
            if (currentTime - lastTime >= 1000) {
                const fps = Math.round((frameCount * 1000) / (currentTime - lastTime));
                document.getElementById('performance').textContent = `${fps}fps`;
                frameCount = 0;
                lastTime = currentTime;
            }
        }

        console.log('âœ… æ‹–æ‹½æµ‹è¯•ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
    </script>
</body>
</html> 