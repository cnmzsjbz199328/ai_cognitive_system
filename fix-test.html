<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿æ¥çº¿ä¿®å¤æµ‹è¯•</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .test-status {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            max-width: 400px;
            font-family: monospace;
        }
        .success { color: #2ecc71; }
        .error { color: #e74c3c; }
        .warning { color: #f39c12; }
        .test-controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(255,255,255,0.95);
            padding: 15px;
            border-radius: 8px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .test-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-btn:hover { background: #2980b9; }
        .test-btn.success { background: #27ae60; }
        .test-btn.error { background: #e74c3c; }
        
        /* ç¡®ä¿å®¹å™¨é€‚å½“å¤§å° */
        .container {
            min-height: 100vh;
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body>
    <div class="test-status" id="test-status">
        <strong>ğŸ”§ è¿æ¥çº¿ä¿®å¤æµ‹è¯•</strong><br>
        <span id="status-text">æ­£åœ¨åˆå§‹åŒ–...</span>
    </div>

    <div class="test-controls">
        <div><strong>æµ‹è¯•æ§åˆ¶</strong></div>
        <button class="test-btn" id="draw-btn" onclick="testDraw()">ç»˜åˆ¶è¿æ¥çº¿</button>
        <button class="test-btn" id="toggle-btn" onclick="testToggle()">åˆ‡æ¢æ˜¾ç¤º</button>
        <button class="test-btn" id="mode-btn" onclick="testMode()">åˆ‡æ¢æ¨¡å¼</button>
        <button class="test-btn" id="simulation-btn" onclick="testSimulation()">æµ‹è¯•æ¨¡æ‹Ÿ</button>
        <div style="margin-top: 10px; font-size: 12px; color: #666;">
            SVGè·¯å¾„æ•°: <span id="path-count">0</span> | 
            çŠ¶æ€: <span id="connection-status">æœªçŸ¥</span>
        </div>
    </div>

    <div class="container">
        <div class="system-title">
            <h1>è¿æ¥çº¿ä¿®å¤æµ‹è¯•</h1>
        </div>

        <svg class="connections-svg" id="connections-svg">
            <!-- è¿æ¥çº¿å°†åœ¨è¿™é‡ŒåŠ¨æ€ç»˜åˆ¶ -->
        </svg>

        <!-- æµ‹è¯•æ¨¡å— -->
        <div class="module" id="external-stimuli" style="top: 120px; left: 150px;">
            <div class="module-name">å¤–éƒ¨åˆºæ¿€</div>
        </div>

        <div class="module" id="perception" style="top: 120px; left: 400px;">
            <div class="module-name">æ„ŸçŸ¥æ¨¡å—</div>
        </div>

        <div class="module" id="ai-cognitive" style="top: 220px; left: 275px;">
            <div class="module-name">AIè®¤çŸ¥æ ¸å¿ƒ</div>
        </div>

        <div class="module" id="thinking-core" style="top: 320px; left: 275px;">
            <div class="module-name">æ€ç»´æ ¸å¿ƒ</div>
        </div>

        <div class="module" id="action-output" style="top: 420px; left: 275px;">
            <div class="module-name">è¾“å‡ºæ¨¡å—</div>
        </div>
    </div>

    <script type="module">
        let config, connections, animation, simulation;
        const statusText = document.getElementById('status-text');
        const pathCount = document.getElementById('path-count');
        const connectionStatus = document.getElementById('connection-status');

        function updateStatus(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            statusText.innerHTML = `${timestamp} - <span class="${type}">${message}</span>`;
            console.log(`[${timestamp}] ${message}`);
        }

        function updateStats() {
            const svg = document.getElementById('connections-svg');
            const paths = svg.querySelectorAll('path');
            pathCount.textContent = paths.length;
            
            if (config) {
                connectionStatus.textContent = config.getShowConnections() ? 'æ˜¾ç¤º' : 'éšè—';
            }
        }

        async function initializeTest() {
            try {
                updateStatus('åŠ è½½æ¨¡å—...', 'info');
                
                // åŠ è½½æ‰€æœ‰éœ€è¦çš„æ¨¡å—
                config = await import('./js/config.js');
                connections = await import('./js/connections.js');
                animation = await import('./js/animation.js');
                simulation = await import('./js/simulation.js');
                
                updateStatus('æ¨¡å—åŠ è½½æˆåŠŸï¼', 'success');
                
                // åˆå§‹åŒ–ç³»ç»Ÿ
                animation.initializeAnimations();
                
                // è‡ªåŠ¨ç»˜åˆ¶è¿æ¥çº¿
                setTimeout(() => {
                    testDraw();
                }, 500);
                
            } catch (error) {
                updateStatus(`æ¨¡å—åŠ è½½å¤±è´¥: ${error.message}`, 'error');
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
            }
        }

        window.testDraw = function() {
            if (!connections) {
                updateStatus('è¿æ¥æ¨¡å—æœªåŠ è½½', 'error');
                return;
            }

            try {
                updateStatus('ç»˜åˆ¶è¿æ¥çº¿...', 'info');
                connections.drawConnections();
                
                setTimeout(() => {
                    const svg = document.getElementById('connections-svg');
                    const paths = svg.querySelectorAll('path');
                    
                    if (paths.length > 0) {
                        updateStatus(`æˆåŠŸç»˜åˆ¶ ${paths.length} æ¡è¿æ¥çº¿`, 'success');
                        document.getElementById('draw-btn').className = 'test-btn success';
                    } else {
                        updateStatus('è¿æ¥çº¿ç»˜åˆ¶å¤±è´¥ - æ— è·¯å¾„ç”Ÿæˆ', 'error');
                        document.getElementById('draw-btn').className = 'test-btn error';
                    }
                    updateStats();
                }, 100);
                
            } catch (error) {
                updateStatus(`ç»˜åˆ¶é”™è¯¯: ${error.message}`, 'error');
                document.getElementById('draw-btn').className = 'test-btn error';
            }
        };

        window.testToggle = function() {
            if (!connections) return;
            
            try {
                connections.toggleConnections();
                updateStatus('åˆ‡æ¢è¿æ¥çº¿æ˜¾ç¤ºçŠ¶æ€', 'success');
                updateStats();
            } catch (error) {
                updateStatus(`åˆ‡æ¢å¤±è´¥: ${error.message}`, 'error');
            }
        };

        window.testMode = function() {
            if (!connections) return;
            
            try {
                const oldMode = config.getConnectionMode();
                connections.toggleConnectionMode();
                const newMode = config.getConnectionMode();
                updateStatus(`è¿æ¥æ¨¡å¼: ${oldMode} â†’ ${newMode}`, 'success');
                updateStats();
            } catch (error) {
                updateStatus(`æ¨¡å¼åˆ‡æ¢å¤±è´¥: ${error.message}`, 'error');
            }
        };

        window.testSimulation = function() {
            if (!simulation || !animation) return;
            
            try {
                // æµ‹è¯•æ¨¡æ‹ŸåŠ¨ç”»
                updateStatus('æµ‹è¯•å…‰ç‚¹æµåŠ¨...', 'info');
                animation.animateConnectionFlow('external-stimuli', 'perception');
                
                setTimeout(() => {
                    updateStatus('å…‰ç‚¹æµåŠ¨æµ‹è¯•å®Œæˆ', 'success');
                }, 2000);
                
            } catch (error) {
                updateStatus(`æ¨¡æ‹Ÿæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        };

        // å¼€å§‹åˆå§‹åŒ–
        initializeTest();

        // å®šæœŸæ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        setInterval(updateStats, 1000);
    </script>
</body>
</html> 