<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIè®¤çŸ¥ç³»ç»Ÿ - ä¿¡æ¯ä¼ å¯¼æ¨¡æ‹Ÿå™¨</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="system-title">
            <h1>AIè®¤çŸ¥ç³»ç»Ÿ - ä¿¡æ¯ä¼ å¯¼æ¨¡æ‹Ÿå™¨</h1>
        </div>

        <svg class="connections-svg" id="connections-svg">
            <!-- è¿æ¥çº¿å°†åœ¨è¿™é‡ŒåŠ¨æ€ç»˜åˆ¶ -->
        </svg>

        <!-- ç¬¬ä¸€å±‚ï¼šå…¨å±€æ—¶é—´ç³»ç»Ÿ -->
        <div class="module" id="global-time" style="top: 80px; left: 50%; transform: translateX(-50%);">
            <div class="module-name">Global Time System<br>å…¨å±€æ—¶é—´ç³»ç»Ÿ</div>
        </div>

        <!-- ç¬¬äºŒå±‚ï¼šè¾“å…¥æµç¨‹ -->
        <div class="module" id="external-stimuli" style="top: 180px; left: 100px;">
            <div class="module-name">External Stimuli<br>å¤–éƒ¨åˆºæ¿€</div>
        </div>

        <div class="module" id="perception" style="top: 180px; left: 350px;">
            <div class="module-name">Perception & Input<br>æ„ŸçŸ¥ä¸è¾“å…¥æ¨¡å—</div>
        </div>

        <div class="module" id="ai-cognitive" style="top: 180px; left: 600px;">
            <div class="module-name">AI Cognitive Core<br>AIè®¤çŸ¥æ ¸å¿ƒ</div>
        </div>

        <!-- ç¬¬ä¸‰å±‚ï¼šæ€ç»´æ ¸å¿ƒ -->
        <div class="module" id="thinking-core" style="top: 280px; left: 50%; transform: translateX(-50%);">
            <div class="module-name">Thinking Core<br>æ€ç»´æ ¸å¿ƒ</div>
        </div>

        <!-- ç¬¬å››å±‚ï¼šå¤„ç†æ¨¡å—ç¾¤ï¼ˆæ°´å¹³æ’åˆ—ï¼‰ -->
        <div class="module" id="personality" style="top: 380px; left: 80px;">
            <div class="module-name">Personality & Emotion<br>ä¸ªæ€§ä¸æƒ…æ„Ÿæ ¸å¿ƒ</div>
        </div>

        <div class="module" id="skills" style="top: 380px; left: 280px;">
            <div class="module-name">Skills Module<br>æŠ€èƒ½æ¨¡å—</div>
        </div>

        <div class="module" id="needs" style="top: 380px; left: 480px;">
            <div class="module-name">Needs & Motivation<br>éœ€æ±‚ä¸åŠ¨æœºç³»ç»Ÿ</div>
        </div>

        <div class="module" id="planning" style="top: 380px; left: 680px;">
            <div class="module-name">Planning System<br>è§„åˆ’ç³»ç»Ÿ</div>
        </div>

        <div class="module" id="relationship" style="top: 380px; left: 880px;">
            <div class="module-name">Relationship Module<br>å…³ç³»æ¨¡å—</div>
        </div>

        <!-- ç¬¬äº”å±‚ï¼šè¾“å‡ºæµç¨‹ -->
        <div class="module" id="action-output" style="top: 480px; left: 50%; transform: translateX(-50%);">
            <div class="module-name">Action & Output<br>è¡ŒåŠ¨ä¸è¾“å‡ºæ¨¡å—</div>
        </div>

        <!-- ç¬¬å…­å±‚ï¼šç¯å¢ƒäº¤äº’å’Œè®°å¿† -->
        <div class="module" id="environment" style="top: 580px; left: 300px;">
            <div class="module-name">Environment Interaction<br>ç¯å¢ƒäº¤äº’æ¨¡å—</div>
        </div>

        <div class="module" id="memory" style="top: 580px; left: 650px;">
            <div class="module-name">Memory System<br>è®°å¿†ç³»ç»Ÿ</div>
        </div>

        <div class="connection-hint">
            <strong>ğŸ’¡ æ“ä½œæç¤ºï¼š</strong><br>
            â€¢ æ‹–æ‹½æ¨¡å—æ”¹å˜ä½ç½®<br>
            â€¢ è¿æ¥çº¿ä¼šè‡ªåŠ¨æ›´æ–°<br>
            â€¢ åˆ‡æ¢è¿æ¥çº¿æ˜¾ç¤º/éšè—<br><br>
            <strong>ğŸ§  æ™ºèƒ½è¿æ¥ç³»ç»Ÿï¼š</strong><br>
            â€¢ æ™ºèƒ½é”šç‚¹ï¼šè‡ªåŠ¨é€‰æ‹©æœ€ä½³è¿æ¥ç‚¹<br>
            â€¢ æ›²çº¿/ç›´è§’ä¸¤ç§è¿æ¥æ¨¡å¼<br>
            â€¢ æ‹–æ‹½æ¨¡å—ï¼Œè¿æ¥çº¿å®æ—¶æ›´æ–°<br>
            â€¢ æ”¯æŒé”šç‚¹å¯è§†åŒ–è°ƒè¯•
        </div>

        <div class="info-panel">
            <div class="info-title">å½“å‰æ´»åŠ¨æ¨¡å—</div>
            <div class="info-content" id="current-info">
                ç‚¹å‡»"å¼€å§‹æ¨¡æ‹Ÿ"æŒ‰é’®å¼€å§‹ä¿¡æ¯ä¼ å¯¼æ¼”ç¤º
            </div>
        </div>

        <div class="control-panel">
            <button class="btn btn-primary" id="start-btn">å¼€å§‹æ¨¡æ‹Ÿ</button>
            <button class="btn btn-secondary" id="stop-btn">åœæ­¢æ¨¡æ‹Ÿ</button>
            <button class="btn btn-secondary" id="reset-btn">é‡ç½®</button>
            <button class="btn btn-toggle" id="connections-toggle">éšè—è¿æ¥çº¿</button>
            <button class="btn btn-toggle" id="mode-toggle">åˆ‡æ¢ä¸ºç›´è§’</button>
            <button class="btn btn-secondary" id="anchors-toggle">æ˜¾ç¤ºé”šç‚¹</button>
            <button class="btn btn-debug" id="debug-draw" style="background: #f39c12;">å¼ºåˆ¶ç»˜åˆ¶</button>
            <div class="speed-control">
                <span>æ¨¡æ‹Ÿé€Ÿåº¦:</span>
                <input type="range" class="speed-slider" min="500" max="3000" value="1500" id="speed-slider">
            </div>
            <div class="speed-control">
                <span>æµåŠ¨é€Ÿåº¦:</span>
                <input type="range" class="speed-slider" min="800" max="4000" value="2000" id="flow-speed-slider">
            </div>
            <div class="control-hint" id="control-hint">
                æœªå¯åŠ¨çŠ¶æ€ä¸‹å¯ä»¥æ‹–åŠ¨æ¨¡å—
            </div>
        </div>
    </div>

    <!-- å±å¹•æ–¹å‘æç¤º -->
    <div class="orientation-hint" id="orientation-hint">
        <h3>ğŸ“± å»ºè®®æ¨ªå±æŸ¥çœ‹</h3>
        <p>ä¸ºäº†æœ€ä½³ä½“éªŒï¼Œè¯·å°†è®¾å¤‡æ—‹è½¬è‡³æ¨ªå±æ¨¡å¼</p>
    </div>

    <!-- ç¼©æ”¾æ§åˆ¶å™¨ -->
    <div class="zoom-controls">
        <button class="zoom-btn" id="zoom-in-btn">+</button>
        <div class="zoom-indicator" id="zoom-indicator">100%</div>
        <button class="zoom-btn" id="zoom-out-btn">âˆ’</button>
        <button class="zoom-btn" id="zoom-reset-btn">âŒ‚</button>
    </div>

    <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div id="status-indicator" style="position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.8); color: white; padding: 5px 10px; border-radius: 5px; font-size: 12px; z-index: 1000;">
        åˆå§‹åŒ–ä¸­...
    </div>

    <!-- æ¨¡å—åŒ–è„šæœ¬åŠ è½½ -->
    <script type="module">
        const statusIndicator = document.getElementById('status-indicator');
        
        function updateStatus(message) {
            statusIndicator.textContent = message;
            console.log('çŠ¶æ€:', message);
        }
        
        updateStatus('åŠ è½½æ¨¡å—...');
        
        try {
            // å¯¼å…¥æ‰€æœ‰æ¨¡å—
            const modules = await Promise.all([
                import('./js/config.js'),
                import('./js/connections.js'),
                import('./js/animation.js'),
                import('./js/simulation.js'),
                import('./js/dragdrop.js'),
                import('./js/zoom.js'),
                import('./js/language.js')
            ]);
            
            updateStatus('æ¨¡å—åŠ è½½å®Œæˆ');
            
            // è§£æ„å¯¼å…¥çš„åŠŸèƒ½
            const config = modules[0];
            const connections = modules[1];
            const animation = modules[2];
            const simulation = modules[3];
            const dragdrop = modules[4];
            const zoom = modules[5];
            const language = modules[6];
            
            // åˆ›å»ºå…¨å±€APIå¯¹è±¡
            window.AICognitiveSystem = {
                // æ¨¡æ‹Ÿæ§åˆ¶
                startSimulation: simulation.startSimulation,
                stopSimulation: simulation.stopSimulation,
                resetSimulation: simulation.resetSimulation,
                
                // è¿æ¥çº¿æ§åˆ¶
                drawConnections: connections.drawConnections,
                toggleConnections: connections.toggleConnections,
                toggleConnectionMode: connections.toggleConnectionMode,
                toggleAnchorPoints: connections.toggleAnchorPoints,
                
                // ç¼©æ”¾æ§åˆ¶
                zoomIn: zoom.zoomIn,
                zoomOut: zoom.zoomOut,
                resetZoom: zoom.resetZoom,
                
                // è°ƒè¯•åŠŸèƒ½
                debugState: config.debugState
            };
            
            updateStatus('ç»‘å®šäº‹ä»¶...');
            
            // ç»‘å®šæŒ‰é’®äº‹ä»¶
            document.getElementById('start-btn').onclick = window.AICognitiveSystem.startSimulation;
            document.getElementById('stop-btn').onclick = window.AICognitiveSystem.stopSimulation;
            document.getElementById('reset-btn').onclick = window.AICognitiveSystem.resetSimulation;
            document.getElementById('connections-toggle').onclick = window.AICognitiveSystem.toggleConnections;
            document.getElementById('mode-toggle').onclick = window.AICognitiveSystem.toggleConnectionMode;
            document.getElementById('anchors-toggle').onclick = window.AICognitiveSystem.toggleAnchorPoints;
            
            // ç¼©æ”¾æŒ‰é’®äº‹ä»¶
            document.getElementById('zoom-in-btn').onclick = window.AICognitiveSystem.zoomIn;
            document.getElementById('zoom-out-btn').onclick = window.AICognitiveSystem.zoomOut;
            document.getElementById('zoom-reset-btn').onclick = window.AICognitiveSystem.resetZoom;
            
            // è°ƒè¯•æŒ‰é’®äº‹ä»¶
            document.getElementById('debug-draw').onclick = () => {
                updateStatus('æ‰‹åŠ¨é‡ç»˜è¿æ¥çº¿...');
                connections.drawConnections();
                const svg = document.getElementById('connections-svg');
                const paths = svg.querySelectorAll('path');
                updateStatus(`æ‰‹åŠ¨ç»˜åˆ¶å®Œæˆ (${paths.length}æ¡è¿æ¥çº¿)`);
                console.log('æ‰‹åŠ¨ç»˜åˆ¶ç»“æœ:', { pathCount: paths.length, svgContent: svg.innerHTML.substring(0, 200) });
            };
            
            // æ»‘å—äº‹ä»¶
            document.getElementById('speed-slider').addEventListener('input', function(e) {
                simulation.setSimulationSpeed(parseInt(e.target.value));
            });
            
            document.getElementById('flow-speed-slider').addEventListener('input', function(e) {
                animation.setFlowSpeedValue(parseInt(e.target.value));
            });
            
            updateStatus('åˆå§‹åŒ–ç³»ç»Ÿ...');
            
            // åˆå§‹åŒ–å„ä¸ªå­ç³»ç»Ÿï¼ˆé¡ºåºå¾ˆé‡è¦ï¼‰
            zoom.initializeZoomSystem();
            animation.initializeAnimations();
            dragdrop.setupDragAndDrop();
            
            // è¯­è¨€ç³»ç»Ÿæœ€ååˆå§‹åŒ–ï¼ˆå› ä¸ºå®ƒéœ€è¦æ“ä½œDOMå…ƒç´ ï¼‰
            setTimeout(() => {
                try {
                    language.initializeLanguageSystem();
                    updateStatus('âœ… è¯­è¨€ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
                } catch (error) {
                    console.warn('è¯­è¨€ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:', error);
                    updateStatus('âš ï¸ è¯­è¨€ç³»ç»Ÿè·³è¿‡ï¼ˆéå…³é”®ï¼‰');
                }
            }, 100);
            
            // ç¡®ä¿è¿æ¥çº¿ç»˜åˆ¶æˆåŠŸ
            function ensureConnectionsDrawn() {
                try {
                    updateStatus('ç»˜åˆ¶è¿æ¥çº¿...');
                    connections.drawConnections();
                    
                    // éªŒè¯è¿æ¥çº¿æ˜¯å¦æˆåŠŸç»˜åˆ¶
                    const svg = document.getElementById('connections-svg');
                    const paths = svg.querySelectorAll('path');
                    
                    if (paths.length > 0) {
                        updateStatus(`âœ… ç³»ç»Ÿå°±ç»ª (${paths.length}æ¡è¿æ¥çº¿)`);
                    } else {
                        updateStatus('âš ï¸ è¿æ¥çº¿æœªæ˜¾ç¤ºï¼Œå°è¯•é‡ç»˜...');
                        // å†æ¬¡å°è¯•ç»˜åˆ¶
                        setTimeout(() => {
                            connections.drawConnections();
                            const retryPaths = svg.querySelectorAll('path');
                            updateStatus(`âœ… é‡ç»˜å®Œæˆ (${retryPaths.length}æ¡è¿æ¥çº¿)`);
                        }, 500);
                    }
                } catch (error) {
                    updateStatus('âŒ è¿æ¥çº¿ç»˜åˆ¶å¤±è´¥: ' + error.message);
                    console.error('è¿æ¥çº¿ç»˜åˆ¶é”™è¯¯:', error);
                }
                
                // 3ç§’åéšè—çŠ¶æ€æŒ‡ç¤ºå™¨
                setTimeout(() => {
                    statusIndicator.style.opacity = '0';
                    setTimeout(() => {
                        statusIndicator.style.display = 'none';
                    }, 500);
                }, 3000);
            }
            
            // å»¶è¿Ÿç¡®ä¿DOMå®Œå…¨åŠ è½½
            setTimeout(ensureConnectionsDrawn, 300);
            
            // çª—å£äº‹ä»¶
            window.addEventListener('resize', () => {
                setTimeout(connections.drawConnections, 100);
            });
            
            window.addEventListener('orientationchange', () => {
                setTimeout(connections.drawConnections, 300);
            });
            
            console.log('ğŸ‰ AIè®¤çŸ¥ç³»ç»Ÿæ¨¡å—åŒ–ç‰ˆæœ¬åŠ è½½å®Œæˆ');
            
        } catch (error) {
            console.error('âŒ ç³»ç»ŸåŠ è½½å¤±è´¥:', error);
            updateStatus('âŒ åŠ è½½å¤±è´¥: ' + error.message);
            
            // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: rgba(231, 76, 60, 0.95); color: white; padding: 20px;
                border-radius: 15px; text-align: center; z-index: 1000;
                max-width: 80%; word-wrap: break-word;
            `;
            errorDiv.innerHTML = `
                <h3>âŒ ç³»ç»ŸåŠ è½½å¤±è´¥</h3>
                <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                <p>è¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯</p>
                <button onclick="location.reload()" style="margin-top: 10px; padding: 5px 15px; border: none; border-radius: 5px; background: white; color: #e74c3c; cursor: pointer;">é‡æ–°åŠ è½½</button>
            `;
            document.body.appendChild(errorDiv);
        }
    </script>
    
    <!-- å¤‡ç”¨è„šæœ¬ï¼ˆç”¨äºä¸æ”¯æŒæ¨¡å—çš„æµè§ˆå™¨ï¼‰ -->
    <script nomodule>
        console.warn('âš ï¸ å½“å‰æµè§ˆå™¨ä¸æ”¯æŒES6æ¨¡å—');
        document.getElementById('status-indicator').textContent = 'âš ï¸ æµè§ˆå™¨ä¸å…¼å®¹';
        
        // æ˜¾ç¤ºå‡çº§æç¤º
        setTimeout(() => {
            const hint = document.createElement('div');
            hint.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: rgba(231, 76, 60, 0.95); color: white; padding: 20px;
                border-radius: 15px; text-align: center; z-index: 1000;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            `;
            hint.innerHTML = `
                <h3>âš ï¸ æµè§ˆå™¨å…¼å®¹æ€§æç¤º</h3>
                <p>å½“å‰æµè§ˆå™¨ä¸æ”¯æŒES6æ¨¡å—</p>
                <p>å»ºè®®ä½¿ç”¨Chromeã€Firefoxã€Safariæˆ–Edgeæœ€æ–°ç‰ˆæœ¬</p>
                <p>æˆ–è€…ä½¿ç”¨å¤‡ç”¨ç‰ˆæœ¬ï¼š<a href="ai_cognitive_system.html" style="color: #ecf0f1; text-decoration: underline;">ç‚¹å‡»è¿™é‡Œ</a></p>
                <button onclick="this.parentNode.remove()" style="margin-top: 10px; padding: 5px 15px; border: none; border-radius: 5px; background: white; color: #e74c3c; cursor: pointer;">æˆ‘çŸ¥é“äº†</button>
            `;
            document.body.appendChild(hint);
        }, 1000);
    </script>
</body>
</html> 